from fastapi import FastAPI, Query
from fastapi.responses import JSONResponse
from jdcal import gcal2jd

app = FastAPI(
    title="Mayan Kin API ‚Äî GMT correlation",
    description="–ß–µ—Å—Ç–Ω—ã–π Mayan Long Count –∏ Tzolkin –Ω–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –∫–æ–Ω—Å—Ç–∞–Ω—Ç–µ GMT correlation (Julian Day 584283).",
    version="1.0.0"
)

SEALS_FULL = [
    {'name': '–ö—Ä–∞—Å–Ω—ã–π –î—Ä–∞–∫–æ–Ω', 'desc': '—Ä–æ–∂–¥–µ–Ω–∏–µ, –ø–∏—Ç–∞–Ω–∏–µ, –Ω–∞—á–∞–ª–æ, –º–∞—Ç–µ—Ä–∏–Ω—Å—Ç–≤–æ'},
    {'name': '–ë–µ–ª—ã–π –í–µ—Ç–µ—Ä', 'desc': '–¥—É—Ö, –æ–±—â–µ–Ω–∏–µ, –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ, –∏—Å—Ç–∏–Ω–∞'},
    {'name': '–°–∏–Ω—è—è –ù–æ—á—å', 'desc': '—Å–Ω–æ–≤–∏–¥–µ–Ω–∏–µ, –∏–Ω—Ç—É–∏—Ü–∏—è, –∏–∑–æ–±–∏–ª–∏–µ, –ø–æ–¥—Å–æ–∑–Ω–∞–Ω–∏–µ'},
    {'name': '–ñ—ë–ª—Ç–æ–µ –°–µ–º—è', 'desc': '—Ä–æ—Å—Ç, —Ä–∞–∑–≤–∏—Ç–∏–µ, –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å, —Ü–≤–µ—Ç–µ–Ω–∏–µ'},
    {'name': '–ö—Ä–∞—Å–Ω–∞—è –ó–º–µ—è', 'desc': '–∂–∏–∑–Ω–µ–Ω–Ω–∞—è —Å–∏–ª–∞, –∏–Ω—Å—Ç–∏–Ω–∫—Ç, —Å–µ–∫—Å—É–∞–ª—å–Ω–æ—Å—Ç—å, –≤—ã–∂–∏–≤–∞–Ω–∏–µ'},
    {'name': '–ë–µ–ª—ã–π –°–æ–µ–¥–∏–Ω–∏—Ç–µ–ª—å –ú–∏—Ä–æ–≤', 'desc': '—Å–æ—á—É–≤—Å—Ç–≤–∏–µ, –ø–æ—Ä—è–¥–æ–∫, —Ä–∞–≤–Ω–æ–≤–µ—Å–∏–µ, —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç—å'},
    {'name': '–°–∏–Ω—è—è –†—É–∫–∞', 'desc': '–∏—Å—Ü–µ–ª–µ–Ω–∏–µ, –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ, –∑–Ω–∞–Ω–∏–µ, –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ'},
    {'name': '–ñ—ë–ª—Ç–∞—è –ó–≤–µ–∑–¥–∞', 'desc': '–∫—Ä–∞—Å–æ—Ç–∞, –∏—Å–∫—É—Å—Å—Ç–≤–æ, –≥–∞—Ä–º–æ–Ω–∏—è, —ç–ª–µ–≥–∞–Ω—Ç–Ω–æ—Å—Ç—å'},
    {'name': '–ö—Ä–∞—Å–Ω–∞—è –õ—É–Ω–∞', 'desc': '–æ—á–∏—â–µ–Ω–∏–µ, –ø–æ—Ç–æ–∫, —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –≤–æ–¥–∞, –¥–≤–∏–∂–µ–Ω–∏–µ —ç–º–æ—Ü–∏–π'},
    {'name': '–ë–µ–ª–∞—è –°–æ–±–∞–∫–∞', 'desc': '–ª—é–±–æ–≤—å, –≤–µ—Ä–Ω–æ—Å—Ç—å, —Å–µ—Ä–¥—Ü–µ, –ø—Ä–µ–¥–∞–Ω–Ω–æ—Å—Ç—å'},
    {'name': '–°–∏–Ω—è—è –û–±–µ–∑—å—è–Ω–∞', 'desc': '–∏–≥—Ä–∞, –º–∞–≥–∏—è, —Å–ø–æ–Ω—Ç–∞–Ω–Ω–æ—Å—Ç—å, —é–º–æ—Ä'},
    {'name': '–ñ—ë–ª—Ç—ã–π –ß–µ–ª–æ–≤–µ–∫', 'desc': '—Å–≤–æ–±–æ–¥–∞ –≤–æ–ª–∏, –≤–ª–∏—è–Ω–∏–µ, –º—É–¥—Ä–æ—Å—Ç—å, –∑—Ä–µ–ª–æ—Å—Ç—å'},
    {'name': '–ö—Ä–∞—Å–Ω—ã–π –ù–µ–±–µ—Å–Ω—ã–π –°—Ç—Ä–∞–Ω–Ω–∏–∫', 'desc': '–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ, –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ, –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏–µ'},
    {'name': '–ë–µ–ª—ã–π –í–æ–ª—à–µ–±–Ω–∏–∫', 'desc': '–≤—Ä–µ–º–µ–Ω–Ω–∞—è –º–∞–≥–∏—è, –æ—á–∞—Ä–æ–≤–∞–Ω–∏–µ, –æ—Ç–∫—Ä—ã—Ç–æ—Å—Ç—å'},
    {'name': '–°–∏–Ω–∏–π –û—Ä—ë–ª', 'desc': '–≤–∏–¥–µ–Ω–∏–µ, —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ, —Ä–∞–∑—É–º, –ø—Ä–æ–Ω–∏—Ü–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å'},
    {'name': '–ñ—ë–ª—Ç—ã–π –í–æ–∏–Ω', 'desc': '–≤–æ–ø—Ä–æ—Å—ã, –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç, —Å–º–µ–ª–æ—Å—Ç—å, —Ö—Ä–∞–±—Ä–æ—Å—Ç—å'},
    {'name': '–ö—Ä–∞—Å–Ω–∞—è –ó–µ–º–ª—è', 'desc': '—ç–≤–æ–ª—é—Ü–∏—è, —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å, –Ω–∞–≤–∏–≥–∞—Ü–∏—è'},
    {'name': '–ë–µ–ª–æ–µ –ó–µ—Ä–∫–∞–ª–æ', 'desc': '–æ—Ç—Ä–∞–∂–µ–Ω–∏–µ, –ø–æ—Ä—è–¥–æ–∫, –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ—Å—Ç—å, –∏—Å—Ç–∏–Ω–∞'},
    {'name': '–°–∏–Ω—è—è –ë—É—Ä—è', 'desc': '–∫–∞—Ç–∞–ª–∏–∑–∞—Ç–æ—Ä, —Å–∞–º–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ, —ç–Ω–µ—Ä–≥–∏—è, —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è'},
    {'name': '–ñ—ë–ª—Ç–æ–µ –°–æ–ª–Ω—Ü–µ', 'desc': '–ø—Ä–æ—Å–≤–µ—Ç–ª–µ–Ω–∏–µ, —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –æ–≥–æ–Ω—å, –∂–∏–∑–Ω—å, –ª—é–±–æ–≤—å'}
]

# üéØ –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π GMT correlation (JD)
MAYAN_EPOCH_JD = 584283  # Julian Day Number

@app.get("/calculate-kin")
def calculate_kin(date: str = Query(..., description="–î–∞—Ç–∞ YYYY-MM-DD")):
    try:
        y, m, d = map(int, date.split("-"))
    except:
        return JSONResponse(status_code=400, content={"error": "–§–æ—Ä–º–∞—Ç –¥–∞—Ç—ã: YYYY-MM-DD"})

    jd = sum(gcal2jd(y, m, d))
    delta_days = int(jd - MAYAN_EPOCH_JD)

    # Long Count
    baktun = delta_days // 144000
    katun = (delta_days % 144000) // 7200
    tun = (delta_days % 7200) // 360
    uinal = (delta_days % 360) // 20
    kin_long = delta_days % 20

    long_count = f"{baktun}.{katun}.{tun}.{uinal}.{kin_long}"

    # Tzolkin
    kin = (delta_days % 260) + 1
    tone = ((kin - 1) % 13) + 1
    seal_index = ((kin - 1) % 20)
    seal_data = SEALS_FULL[seal_index]

    return {
        "LongCount": long_count,
        "Kin": kin,
        "Tone": tone,
        "SealNumber": seal_index + 1,
        "SealName": seal_data["name"],
        "SealFull": f"{seal_data['name']} ‚Äî {seal_data['desc']}",
        "DeltaDays": delta_days
    }
